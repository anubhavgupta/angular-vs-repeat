//
// Copyright Kamil PÄ™kala http://github.com/kamilkp
// Angular Virtual Scroll Repeat v1.1.7 2016/03/08
//
!function(a,b,c){"use strict";function d(){if("pageYOffset"in a)return{scrollTop:pageYOffset,scrollLeft:pageXOffset};var b,c,d=document,e=d.documentElement,f=d.body;return b=e.scrollLeft||f.scrollLeft||0,c=e.scrollTop||f.scrollTop||0,{scrollTop:c,scrollLeft:b}}function e(b,c){return b===a?"clientWidth"===c?a.innerWidth:a.innerHeight:b[c]}function f(b,c){return b===a?d()[c]:b[c]}function g(b,c,e){return b.getBoundingClientRect()[e?"left":"top"]-(c===a?0:c.getBoundingClientRect()[e?"left":"top"])+(c===a?d():c)[e?"scrollLeft":"scrollTop"]}var h=document.documentElement,i=h.matches?"matches":h.matchesSelector?"matchesSelector":h.webkitMatches?"webkitMatches":h.webkitMatchesSelector?"webkitMatchesSelector":h.msMatches?"msMatches":h.msMatchesSelector?"msMatchesSelector":h.mozMatches?"mozMatches":h.mozMatchesSelector?"mozMatchesSelector":null,j=b.element.prototype.closest||function(a){for(var c=this[0].parentNode;c!==document.documentElement&&null!=c&&!c[i](a);)c=c.parentNode;return c&&c[i](a)?b.element(c):b.element()},k=b.module("vs-repeat",[]).directive("vsRepeat",["$compile","$parse",function(d,h){return{restrict:"A",scope:!0,compile:function(i,k){var l,m,n,o,p,q,r=b.isDefined(k.vsRepeatContainer)?b.element(i[0].querySelector(k.vsRepeatContainer)):i,s=r.children().eq(0),t=s[0].outerHTML,u="$vs_collection",v=!1,w=!1,x={vsRepeat:"elementSize",vsOffsetBefore:"offsetBefore",vsOffsetAfter:"offsetAfter",vsScrolledToEndOffset:"scrolledToEndOffset",vsExcess:"excess"};if(s.attr("ng-repeat"))q="ng-repeat",l=s.attr("ng-repeat");else if(s.attr("data-ng-repeat"))q="data-ng-repeat",l=s.attr("data-ng-repeat");else if(s.attr("ng-repeat-start"))v=!0,q="ng-repeat-start",l=s.attr("ng-repeat-start");else{if(!s.attr("data-ng-repeat-start"))throw new Error("angular-vs-repeat: no ng-repeat directive on a child element");v=!0,q="data-ng-repeat-start",l=s.attr("data-ng-repeat-start")}if(m=/^\s*(\S+)\s+in\s+([\S\s]+?)(track\s+by\s+\S+)?$/.exec(l),n=m[1],o=m[2],p=m[3],v)for(var y=0,z=r.children().eq(0);null==z.attr("ng-repeat-end")&&null==z.attr("data-ng-repeat-end");)y++,z=r.children().eq(y),t+=z[0].outerHTML;return r.empty(),{pre:function(i,k,l){function m(){w?(a.cancelAnimationFrame(U),U=a.requestAnimationFrame(z)):z()}function r(){if(!H||H.length<1)i[u]=[],D=0,i.sizesCumulative=[0];else if(D=H.length,O){i.sizes=H.map(function(a){var c=i.$new(!1);b.extend(c,a),c[n]=a;var d=l.vsSize||l.vsSizeProperty?c.$eval(l.vsSize||l.vsSizeProperty):i.elementSize;return c.$destroy(),d});var a=0;i.sizesCumulative=i.sizes.map(function(b){var c=a;return a+=b,c}),i.sizesCumulative.push(a)}else s();m()}function s(){N&&i.$$postDigest(function(){if(E[0].offsetHeight||E[0].offsetWidth){for(var a=E.children(),b=0,c=!1,d=!1;b<a.length;){if(null!=a[b].attributes[q]||d){if(c||(i.elementSize=0),c=!0,a[b][S]&&(i.elementSize+=a[b][S]),!v)break;if(null!=a[b].attributes["ng-repeat-end"]||null!=a[b].attributes["data-ng-repeat-end"])break;d=!0}b++}c&&(z(),N=!1,i.$root&&!i.$root.$$phase&&i.$apply())}else var e=i.$watch(function(){(E[0].offsetHeight||E[0].offsetWidth)&&(e(),s())})})}function y(){var a="tr"===G?"":"min-";return K?a+"width":a+"height"}function z(){$=void 0,_=void 0,aa=D,ba=0,A(O?i.sizesCumulative[D]:i.elementSize*D),C(),i.$emit("vsRepeatReinitialized",i.startIndex,i.endIndex)}function A(a){i.totalSize=i.offsetBefore+a+i.offsetAfter}function B(){var a=e(P[0],R);a!==ca&&(z(),i.$root&&!i.$root.$$phase&&i.$apply()),ca=a}function C(){var a=f(P[0],T),b=e(P[0],R);if(0===b){if(J&&ca&&ca>0)return;for(var c=P[0].parentElement;b<=i.elementSize&&c;)b=e(c,R),c=c.parentElement}ca=b;var d=E[0]===P[0]?0:g(E[0],P[0],K),j=i.startIndex,k=i.endIndex;if(O){for(j=0;i.sizesCumulative[j]<a-i.offsetBefore-d;)j++;for(j>0&&j--,j=Math.max(Math.floor(j-i.excess/2),0),k=j;i.sizesCumulative[k]<a-i.offsetBefore-d+b;)k++;k=Math.min(Math.ceil(k+i.excess/2),D)}else j=Math.max(Math.floor((a-i.offsetBefore-d)/i.elementSize)-i.excess/2,0),k=Math.min(j+Math.ceil(b/i.elementSize)+i.excess,D);aa=Math.min(j,aa),ba=Math.max(k,ba),i.startIndex=Q.latch?aa:j,i.endIndex=Q.latch?ba:k;var m=!1;if(null==$?m=!0:null==_&&(m=!0),m||(Q.hunked?Math.abs(i.startIndex-$)>=i.excess/2||0===i.startIndex&&0!==$?m=!0:(Math.abs(i.endIndex-_)>=i.excess/2||i.endIndex===D&&_!==D)&&(m=!0):m=i.startIndex!==$||i.endIndex!==_),m){if(i[u]=H.slice(i.startIndex,i.endIndex),i.$emit("vsRepeatInnerCollectionUpdated",i.startIndex,i.endIndex,$,_),l.vsScrolledToEnd){var n=H.length-(i.scrolledToEndOffset||0);(i.endIndex>=n&&_<n||H.length&&i.endIndex===H.length)&&i.$eval(l.vsScrolledToEnd)}$=i.startIndex,_=i.endIndex;var o=O?"(sizesCumulative[$index + startIndex] + offsetBefore)":"(($index + startIndex) * elementSize + offsetBefore)",p=h(o),q=p(i,{$index:0}),r=p(i,{$index:i[u].length}),s=i.totalSize;L.css(y(),q+"px"),M.css(y(),s-r+"px")}return m}var D,E=b.isDefined(l.vsRepeatContainer)?b.element(k[0].querySelector(l.vsRepeatContainer)):k,F=b.element(t),G=F[0].tagName.toLowerCase(),H=[],I=b.isDefined(l.vsRepeatTrackBy)?l.vsRepeatTrackBy:void 0,J=!1,K=void 0!==l.vsHorizontal,L=b.element("<"+G+' class="vs-repeat-before-content"></'+G+">"),M=b.element("<"+G+' class="vs-repeat-after-content"></'+G+">"),N=!l.vsRepeat,O=!!l.vsSize||!!l.vsSizeProperty,P=l.vsScrollParent?"window"===l.vsScrollParent?b.element(a):j.call(E,l.vsScrollParent):E,Q="vsOptions"in l?i.$eval(l.vsOptions):{},R=K?"clientWidth":"clientHeight",S=K?"offsetWidth":"offsetHeight",T=K?"scrollLeft":"scrollTop";if(i.totalSize=0,"enableReinitInRaf"in l&&(w=i.$eval(l.enableReinitInRaf)),!("vsSize"in l)&&"vsSizeProperty"in l&&console.warn("vs-size-property attribute is deprecated. Please use vs-size attribute which also accepts angular expressions."),0===P.length)throw"Specified scroll parent selector did not match any element";i.$scrollParent=P,O&&(i.sizesCumulative=[]),i.elementSize=+l.vsRepeat||e(P[0],R)||50,i.offsetBefore=0,i.offsetAfter=0,i.excess=2,K?(L.css("height","100%"),M.css("height","100%")):(L.css("width","100%"),M.css("width","100%"));var U;Object.keys(x).forEach(function(a){l[a]&&l.$observe(a,function(b){i[x[a]]=+b,m()})});var V=[];i.$watchCollection(o,function(a){if(H=a||[],i.endIndex&&(i[u]=H.slice(i.startIndex,i.endIndex)),I){var b=c.map(a,I);if(c.isEqual(b,V))return;V=b}r(),H&&H.length>0&&(J=!0)}),F.eq(0).attr(q,n+" in "+u+(p?" "+p:"")),F.addClass("vs-repeat-repeated-element"),E.append(L),E.append(F),d(F)(i),E.append(M),i.startIndex=0,i.endIndex=0;var W=function(){C()&&!i.$$phase&&i.$digest()},X=c.throttle(W,50);P.on("scroll",X);var Y=function(){void 0!==l.vsAutoresize&&(N=!0,s(),i.$root&&!i.$root.$$phase&&i.$apply()),C()&&i.$evalAsync()},Z=c.debounce(Y,200);b.element(a).on("resize",Z),i.$on("$destroy",function(){w&&a.cancelAnimationFrame(U),b.element(a).off("resize",Z),P.off("scroll",X)}),i.$on("vsRepeatTrigger",r),i.$on("vsRepeatResize",function(){N=!0,s()});var $,_,aa,ba;i.$on("vsRenderAll",function(){Q.latch&&setTimeout(function(){var a=D;ba=Math.max(a,ba),i.endIndex=Q.latch?ba:a,i[u]=H.slice(i.startIndex,i.endIndex),_=i.endIndex,i.$$postDigest(function(){L.css(y(),0),M.css(y(),0)}),i.$evalAsync(function(){i.$emit("vsRenderAllDone")})})});var ca;b.isDefined(l.vsCheckClientSize)&&!!l.vsCheckClientSize&&i.$watch(function(){"function"==typeof a.requestAnimationFrame?a.requestAnimationFrame(B):B()})}}}}}]);"undefined"!=typeof module&&module.exports&&(module.exports=k.name)}(window,window.angular,window._);